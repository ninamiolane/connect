
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{inspect}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}111}]:} \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Preprocessing Neural Spike Data.\PYZdq{}\PYZdq{}\PYZdq{}}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}111}]:} 'Preprocessing Neural Spike Data.'
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{glob}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{os}
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
        
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{from} \PY{n+nn}{scipy} \PY{k}{import} \PY{n}{signal}
        
        \PY{k+kn}{import} \PY{n+nn}{warnings}
        \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ignore}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        
        \PY{n}{HOME\PYZus{}DIR} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/home/nina/code/sommet}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{DATA\PYZus{}DIR} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{HOME\PYZus{}DIR}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}05\PYZhy{}31\PYZus{}15\PYZhy{}43\PYZhy{}39}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \hypertarget{configuration-parameters}{%
\section{Configuration Parameters}\label{configuration-parameters}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{n}{HEADER\PYZus{}SIZE} \PY{o}{=} \PY{l+m+mi}{16} \PY{o}{*} \PY{l+m+mi}{1024}  \PY{c+c1}{\PYZsh{} Header size in neuralynx formats}
        
        \PY{n}{N\PYZus{}ELECTRODES} \PY{o}{=} \PY{l+m+mi}{32}
        \PY{n}{SELECTED\PYZus{}ELECTRODES} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}
        
        \PY{n}{SF} \PY{o}{=} \PY{l+m+mi}{32000}  \PY{c+c1}{\PYZsh{} sampling rate s\PYZca{}\PYZhy{}1}
        \PY{n}{NYQ} \PY{o}{=} \PY{n}{SF} \PY{o}{/} \PY{l+m+mi}{2}
        
        \PY{n}{LOWCUT} \PY{o}{=} \PY{l+m+mi}{600}  \PY{c+c1}{\PYZsh{} Hz}
        \PY{n}{HIGHCUT} \PY{o}{=} \PY{l+m+mi}{7000}  \PY{c+c1}{\PYZsh{} Hz}
        \PY{n}{DELTA} \PY{o}{=} \PY{l+m+mi}{100}  \PY{c+c1}{\PYZsh{} Hz}
        
        \PY{n}{CHEBY\PYZus{}ORDER} \PY{o}{=} \PY{l+m+mi}{6}
        \PY{n}{CHEBY\PYZus{}RIPPLE} \PY{o}{=} \PY{l+m+mf}{0.01}  \PY{c+c1}{\PYZsh{} DB}
        
        \PY{n}{CHEBY\PYZus{}LOWCUT\PYZus{}HZ} \PY{o}{=} \PY{n}{LOWCUT} \PY{o}{\PYZhy{}} \PY{l+m+mi}{4} \PY{o}{*} \PY{n}{DELTA} \PY{c+c1}{\PYZsh{} 200 Hz}
        \PY{n}{CHEBY\PYZus{}LOWCUT} \PY{o}{=} \PY{n}{CHEBY\PYZus{}LOWCUT\PYZus{}HZ} \PY{o}{/} \PY{n}{NYQ}  \PY{c+c1}{\PYZsh{} 0.0125 NYQ units}
        \PY{n}{CHEBY\PYZus{}HIGHCUT\PYZus{}HZ} \PY{o}{=} \PY{n}{HIGHCUT} \PY{o}{+} \PY{l+m+mi}{4} \PY{o}{*} \PY{n}{DELTA}  \PY{c+c1}{\PYZsh{} 7400 Hz}
        \PY{n}{CHEBY\PYZus{}HIGHCUT} \PY{o}{=} \PY{n}{CHEBY\PYZus{}HIGHCUT\PYZus{}HZ} \PY{o}{/} \PY{n}{NYQ}  \PY{c+c1}{\PYZsh{} 0.4625 NYQ units }
        
        \PY{n}{CHEBY\PYZus{}SPECS} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cheby filter cutoff frequencies: [}\PY{l+s+si}{\PYZob{}:.4f\PYZcb{}}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZob{}:.4f\PYZcb{}}\PY{l+s+s1}{] = [}\PY{l+s+si}{\PYZob{}:.0f\PYZcb{}}\PY{l+s+s1}{Hz, }\PY{l+s+si}{\PYZob{}:.0f\PYZcb{}}\PY{l+s+s1}{Hz]}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{n}{CHEBY\PYZus{}LOWCUT}\PY{p}{,} \PY{n}{CHEBY\PYZus{}HIGHCUT}\PY{p}{,} \PY{n}{CHEBY\PYZus{}LOWCUT\PYZus{}HZ}\PY{p}{,} \PY{n}{CHEBY\PYZus{}HIGHCUT\PYZus{}HZ}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{CHEBY\PYZus{}SPECS}\PY{p}{)}
        
        \PY{n}{FIR\PYZus{}ORDER} \PY{o}{=} \PY{l+m+mi}{50}  \PY{c+c1}{\PYZsh{} Needs to be even, so that FIR length is odd, and FIR is type I}
        
        \PY{n}{FIR\PYZus{}LOWCUT\PYZus{}HZ} \PY{o}{=} \PY{n}{LOWCUT} \PY{o}{\PYZhy{}} \PY{n}{DELTA}  \PY{c+c1}{\PYZsh{} 500 Hz}
        \PY{n}{FIR\PYZus{}LOWCUT} \PY{o}{=} \PY{n}{FIR\PYZus{}LOWCUT\PYZus{}HZ} \PY{o}{/} \PY{n}{NYQ}  \PY{c+c1}{\PYZsh{} 0.03125 NYQ units}
        \PY{n}{FIR\PYZus{}HIGHCUT\PYZus{}HZ} \PY{o}{=} \PY{n}{HIGHCUT} \PY{o}{+} \PY{n}{DELTA}  \PY{c+c1}{\PYZsh{} 7100 Hz}
        \PY{n}{FIR\PYZus{}HIGHCUT} \PY{o}{=} \PY{n}{FIR\PYZus{}HIGHCUT\PYZus{}HZ} \PY{o}{/} \PY{n}{NYQ}  \PY{c+c1}{\PYZsh{} 0.44375 NYQ units}
        
        \PY{n}{FIR\PYZus{}SPECS} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{FIR filter cutoff frequencies: [}\PY{l+s+si}{\PYZob{}:.4f\PYZcb{}}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZob{}:.4f\PYZcb{}}\PY{l+s+s1}{] = [}\PY{l+s+si}{\PYZob{}:.0f\PYZcb{}}\PY{l+s+s1}{Hz, }\PY{l+s+si}{\PYZob{}:.0f\PYZcb{}}\PY{l+s+s1}{Hz]}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{n}{FIR\PYZus{}LOWCUT}\PY{p}{,} \PY{n}{FIR\PYZus{}HIGHCUT}\PY{p}{,} \PY{n}{FIR\PYZus{}LOWCUT\PYZus{}HZ}\PY{p}{,} \PY{n}{FIR\PYZus{}HIGHCUT\PYZus{}HZ}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{)}
        
        \PY{n}{EXTREME\PYZus{}AMPLITUDE\PYZus{}COEF} \PY{o}{=} \PY{l+m+mf}{0.9}
        
        \PY{n}{MIN\PYZus{}FLAT} \PY{o}{=} \PY{l+m+mi}{5}
        \PY{n}{PAD\PYZus{}FLAT} \PY{o}{=} \PY{l+m+mi}{100}
        
        \PY{n}{SPIKE\PYZus{}THRESHOLD\PYZus{}STD} \PY{o}{=} \PY{l+m+mf}{3.1} \PY{c+c1}{\PYZsh{} spike threshold in standard deviations}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Cheby filter cutoff frequencies: [0.0125, 0.4625] = [200Hz, 7400Hz]
FIR filter cutoff frequencies: [0.0312, 0.4437] = [500Hz, 7100Hz]

    \end{Verbatim}

    \hypertarget{load-and-plot-ncs-files-neural-spikes-samples}{%
\section{1. Load and Plot NCS files: Neural Spikes
Samples}\label{load-and-plot-ncs-files-neural-spikes-samples}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k}{def} \PY{n+nf}{load\PYZus{}ncs}\PY{p}{(}\PY{n}{data\PYZus{}file}\PY{p}{,} \PY{n}{electrode\PYZus{}id}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{    Read Neuralynx NCS data.}
        \PY{l+s+sd}{    https://neuralynx.com/software/NeuralynxDataFileFormats.pdf}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    Note: Electrodes are numbered 1\PYZhy{}32 in filenames, but 0\PYZhy{}31 in NCS.}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{c+c1}{\PYZsh{} QUESTION: What is the deal with the Channel Number and 50863 bad elements after CSC1?}
            \PY{c+c1}{\PYZsh{} QUESTION: What is the deal with NumValidSamples and could we use it to eliminate some samples?}
            \PY{c+c1}{\PYZsh{} \PYZhy{}\PYZhy{}\PYZgt{} Is it a sign of saturation?}
            \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{data\PYZus{}file}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{fid}\PY{p}{:}
                \PY{n}{fid}\PY{o}{.}\PY{n}{seek}\PY{p}{(}\PY{n}{HEADER\PYZus{}SIZE}\PY{p}{)}
        
                \PY{n}{ncs\PYZus{}data\PYZus{}format} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dtype}\PY{p}{(}\PY{p}{[}
                    \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TimeStamp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint64}\PY{p}{)}\PY{p}{,}
                    \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ChannelNumber}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint32}\PY{p}{)}\PY{p}{,}
                    \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SampleFreq}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint32}\PY{p}{)}\PY{p}{,}
                    \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint32}\PY{p}{)}\PY{p}{,}
                    \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int16}\PY{p}{,} \PY{l+m+mi}{512}\PY{p}{)}\PY{p}{]}\PY{p}{)}
                \PY{n}{raw} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{fromfile}\PY{p}{(}\PY{n}{fid}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{ncs\PYZus{}data\PYZus{}format}\PY{p}{)}
                
            \PY{k}{assert} \PY{n}{np}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SampleFreq}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{n}{SF}\PY{p}{)}
            \PY{k}{if} \PY{o+ow}{not} \PY{n}{np}\PY{o}{.}\PY{n}{all}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ChannelNumber}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{n}{electrode\PYZus{}id}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{! \PYZhy{} Warning: There are }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ elements whose ChannelNumber}\PY{l+s+s1}{\PYZsq{}}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ does not correspond to the electrode ID.}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ChannelNumber}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{!=}\PY{n}{electrode\PYZus{}id}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
            
            \PY{k}{return} \PY{n}{raw}        
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k}{def} \PY{n+nf}{load\PYZus{}samples}\PY{p}{(}\PY{n}{data\PYZus{}dir}\PY{o}{=}\PY{n}{DATA\PYZus{}DIR}\PY{p}{,} \PY{n}{n\PYZus{}electrodes}\PY{o}{=}\PY{n}{N\PYZus{}ELECTRODES}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{    Load NCS from all electrodes, extract samples, concatenate in an array of dim:}
        \PY{l+s+sd}{    n\PYZus{}samples x n\PYZus{}electrodes}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    Note: Electrodes are numbered 1\PYZhy{}32 in filenames, but 0\PYZhy{}31 in NCS.}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{c+c1}{\PYZsh{} QUESTION: Why is there nothing in the \PYZus{}0001.ncs files? What are they here for?}
            \PY{c+c1}{\PYZsh{} QUESTION: Why if raw[\PYZsq{}Samples\PYZsq{}] of shape (n, 512), what are the 512 for? It seems to be Cheetah specs.}
            \PY{c+c1}{\PYZsh{} QUESTION: Is it ok to \PYZdq{}ravel\PYZdq{} the 512 columns, i.e. to flatten the array row by row?}
            \PY{n}{all\PYZus{}samples} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                \PY{n}{filename} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CSC}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{.ncs}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
                \PY{n}{filepath} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{data\PYZus{}dir}\PY{p}{,} \PY{n}{filename}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{...}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{filepath}\PY{p}{)}
                \PY{n}{raw} \PY{o}{=} \PY{n}{load\PYZus{}ncs}\PY{p}{(}\PY{n}{filepath}\PY{p}{)}
                \PY{n}{samples} \PY{o}{=} \PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                \PY{n}{all\PYZus{}samples}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
                
            \PY{n}{all\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{all\PYZus{}samples}\PY{p}{)}
            \PY{k}{assert} \PY{n}{all\PYZus{}samples}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{n}{n\PYZus{}electrodes}
            \PY{k}{return} \PY{n}{all\PYZus{}samples}        
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{n}{samples} \PY{o}{=} \PY{n}{load\PYZus{}samples}\PY{p}{(}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Size of samples data: (}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{)}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC1.ncs{\ldots}
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC2.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC3.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC4.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC5.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC6.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC7.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC8.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC9.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC10.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC11.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC12.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC13.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC14.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC15.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC16.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC17.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC18.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC19.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC20.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC21.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC22.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC23.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC24.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC25.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC26.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC27.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC28.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC29.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC30.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC31.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Loading /home/nina/code/sommet/2018-05-31\_15-43-39/CSC32.ncs{\ldots}
! - Warning: There are 50863 elements whose ChannelNumber does not correspond to the electrode ID.
Size of samples data: (32, 26041856)

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{k}{def} \PY{n+nf}{normalize}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
            \PY{n}{nanmean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmean}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{n}{axis}\PY{p}{)}
            \PY{n}{nanstd} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{n}{axis}\PY{p}{)}
            \PY{n}{normalized\PYZus{}samples} \PY{o}{=} \PY{p}{(}\PY{n}{samples} \PY{o}{\PYZhy{}} \PY{n}{nanmean}\PY{p}{)} \PY{o}{/} \PY{n}{nanstd}
            \PY{k}{return} \PY{n}{normalized\PYZus{}samples}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{k}{def} \PY{n+nf}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{sf}\PY{o}{=}\PY{n}{SF}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{    Plot first ms of the samples.}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{k}{if} \PY{n}{electrodes\PYZus{}nums} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                \PY{n}{electrodes\PYZus{}nums} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N\PYZus{}ELECTRODES}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{electrodes\PYZus{}nums}\PY{p}{,} \PY{n+nb}{int}\PY{p}{)}\PY{p}{:}
                \PY{n}{electrodes\PYZus{}nums} \PY{o}{=} \PY{p}{[}\PY{n}{electrodes\PYZus{}nums}\PY{p}{]}
                
            \PY{n}{electrodes\PYZus{}ids} \PY{o}{=} \PY{p}{[}\PY{n}{num} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{k}{for} \PY{n}{num} \PY{o+ow}{in} \PY{n}{electrodes\PYZus{}nums}\PY{p}{]}
                
            \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
            \PY{n}{n\PYZus{}secs} \PY{o}{=} \PY{l+m+mf}{0.001} \PY{o}{*} \PY{n}{n\PYZus{}msecs}
            
            \PY{n}{last\PYZus{}time\PYZus{}stamp\PYZus{}id} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{floor}\PY{p}{(}\PY{n}{n\PYZus{}secs}\PY{o}{*}\PY{n}{SF}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            
            \PY{c+c1}{\PYZsh{} Total duration of recording in seconds}
            \PY{n}{dur\PYZus{}sec} \PY{o}{=}  \PY{n}{n\PYZus{}samples} \PY{o}{/} \PY{n}{sf}
            
            \PY{n}{time\PYZus{}sec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{dur\PYZus{}sec}\PY{p}{,} \PY{n}{n\PYZus{}samples}\PY{p}{)}
            \PY{n}{time\PYZus{}msec} \PY{o}{=} \PY{l+m+mi}{1000} \PY{o}{*} \PY{n}{time\PYZus{}sec}
                
            \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{n}{figsize}\PY{p}{)}
            
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{electrodes\PYZus{}ids}\PY{p}{:}
                \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
                    \PY{n}{time\PYZus{}msec}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{n}{last\PYZus{}time\PYZus{}stamp\PYZus{}id}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} 
                    \PY{n}{samples}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{:}\PY{n}{last\PYZus{}time\PYZus{}stamp\PYZus{}id}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                    \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Electrode: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}
                \PY{n}{label}\PY{o}{=}\PY{n}{title}\PY{p}{,}
                \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{23}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{time\PYZus{}msec}\PY{p}{[}\PY{n}{last\PYZus{}time\PYZus{}stamp\PYZus{}id}\PY{p}{]}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{time [ms]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{amplitude [uV]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
            
            \PY{n}{chartBox} \PY{o}{=} \PY{n}{ax}\PY{o}{.}\PY{n}{get\PYZus{}position}\PY{p}{(}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}position}\PY{p}{(}\PY{p}{[}\PY{n}{chartBox}\PY{o}{.}\PY{n}{x0}\PY{p}{,} \PY{n}{chartBox}\PY{o}{.}\PY{n}{y0}\PY{p}{,} \PY{n}{chartBox}\PY{o}{.}\PY{n}{width}\PY{o}{*}\PY{l+m+mf}{0.6}\PY{p}{,} \PY{n}{chartBox}\PY{o}{.}\PY{n}{height}\PY{p}{]}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper center}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{bbox\PYZus{}to\PYZus{}anchor}\PY{o}{=}\PY{p}{(}\PY{l+m+mf}{1.2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{shadow}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ncol}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{k}{def} \PY{n+nf}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{sf}\PY{o}{=}\PY{n}{SF}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{list\PYZus{}n\PYZus{}msecs} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
                \PY{n}{dur\PYZus{}sec} \PY{o}{=}  \PY{n}{n\PYZus{}samples} \PY{o}{/} \PY{n}{sf}
                \PY{n}{n\PYZus{}msecs} \PY{o}{=} \PY{l+m+mi}{1000} \PY{o}{*} \PY{n}{dur\PYZus{}sec}
                \PY{n}{plot\PYZus{}samples}\PY{p}{(}
                        \PY{n}{samples}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{n}{n\PYZus{}msecs}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{electrodes\PYZus{}nums}\PY{p}{,} \PY{n}{sf}\PY{o}{=}\PY{n}{sf}\PY{p}{)}
                
            \PY{k}{else}\PY{p}{:}
                \PY{k}{for} \PY{n}{n\PYZus{}msecs} \PY{o+ow}{in} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{p}{:}
                    \PY{n}{plot\PYZus{}samples}\PY{p}{(}
                        \PY{n}{samples}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{n}{n\PYZus{}msecs}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{electrodes\PYZus{}nums}\PY{p}{,} \PY{n}{sf}\PY{o}{=}\PY{n}{sf}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Raw Samples \PYZhy{} Sampling Frequency = }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{Hz}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{SF}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} All electrodes}
        \PY{c+c1}{\PYZsh{} QUESTION: Why these random vertical translations of the signals?}
        \PY{c+c1}{\PYZsh{} QUESTION: Should we renormalized here already?}
        \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
            \PY{n}{samples}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Selected electrodes}
        \PY{c+c1}{\PYZsh{} QUESTION: Why do electrodes 1 and 2 seem to be inversed from one another?}
        \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
            \PY{n}{samples}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_11_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{preprocessing-filtering-by-cheby1-and-fir}{%
\section{Preprocessing: Filtering by Cheby1 and
FIR}\label{preprocessing-filtering-by-cheby1-and-fir}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{c+c1}{\PYZsh{} QUESTION: Why starting with the filters, not with removals of flatnesses?}
         \PY{c+c1}{\PYZsh{} QUESTION / VERIFICATION: We cannot remove the \PYZdq{}extreme amplitudes\PYZdq{}, bcs these are currently extreme discontinuites:}
         \PY{c+c1}{\PYZsh{} \PYZhy{}\PYZhy{}\PYZgt{} need the filters.}
         \PY{k}{def} \PY{n+nf}{plot\PYZus{}frequency\PYZus{}response\PYZus{}analog}\PY{p}{(}\PY{n}{b}\PY{p}{,} \PY{n}{a}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Analog: use freqs.\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{w}\PY{p}{,} \PY{n}{h} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{freqs}\PY{p}{(}\PY{n}{b}\PY{p}{,} \PY{n}{a}\PY{p}{,} \PY{n}{worN}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{logspace}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}\PY{p}{)}  
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{semilogx}\PY{p}{(}\PY{n}{w}\PY{p}{,} \PY{l+m+mi}{20} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{h}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Frequency}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Amplitude response [dB]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{k}{def} \PY{n+nf}{plot\PYZus{}frequency\PYZus{}response\PYZus{}digital}\PY{p}{(}\PY{n}{b}\PY{p}{,} \PY{n}{a}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Digital: use freqz.\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{w}\PY{p}{,} \PY{n}{h} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{freqz}\PY{p}{(}\PY{n}{b}\PY{p}{,} \PY{n}{a}\PY{p}{,} \PY{n}{worN}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{logspace}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{)}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{semilogx}\PY{p}{(}\PY{n}{w}\PY{p}{,} \PY{l+m+mi}{20} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{h}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Frequency [rad/sample]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Here the digital thing?}
             \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Amplitude response [dB]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \hypertarget{filter-cheby}{%
\subsection{Filter Cheby}\label{filter-cheby}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{k}{def} \PY{n+nf}{filter\PYZus{}cheby}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{order}\PY{o}{=}\PY{n}{CHEBY\PYZus{}ORDER}\PY{p}{,} \PY{n}{ripple}\PY{o}{=}\PY{n}{CHEBY\PYZus{}RIPPLE}\PY{p}{,} \PY{n}{lowcut}\PY{o}{=}\PY{n}{CHEBY\PYZus{}LOWCUT}\PY{p}{,} \PY{n}{highcut}\PY{o}{=}\PY{n}{CHEBY\PYZus{}HIGHCUT}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{    First filter applied by Eric, in matlab code from Archive.zip.}
         \PY{l+s+sd}{    IIR cuts low frequencies with a sharp filter.}
         \PY{l+s+sd}{    Note: Similar to the bandpass filter from the tutorial.}
         \PY{l+s+sd}{    It is actually a bandpass filter, with ripples.}
         \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{cutoff\PYZus{}frequencies} \PY{o}{=} \PY{p}{[}\PY{n}{lowcut}\PY{p}{,} \PY{n}{highcut}\PY{p}{]}
         
             \PY{n}{b0}\PY{p}{,} \PY{n}{a0} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{cheby1}\PY{p}{(}
                 \PY{n}{N}\PY{o}{=}\PY{n}{order}\PY{p}{,} 
                 \PY{n}{rp}\PY{o}{=}\PY{n}{ripple}\PY{p}{,}
                 \PY{n}{Wn}\PY{o}{=}\PY{n}{cutoff\PYZus{}frequencies}\PY{p}{,} 
                 \PY{n}{btype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bandpass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{filtfilt}\PY{p}{(}\PY{n}{b0}\PY{p}{,} \PY{n}{a0}\PY{p}{,} \PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{return} \PY{n}{filtered\PYZus{}samples}\PY{p}{,} \PY{n}{b0}\PY{p}{,} \PY{n}{a0}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{samples\PYZus{}cheby}\PY{p}{,} \PY{n}{b0}\PY{p}{,} \PY{n}{a0} \PY{o}{=} \PY{n}{filter\PYZus{}cheby}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{n}{plot\PYZus{}frequency\PYZus{}response\PYZus{}analog}\PY{p}{(}\PY{n}{b0}\PY{p}{,} \PY{n}{a0}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} All electrodes}
         \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
             \PY{n}{samples\PYZus{}cheby}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{CHEBY\PYZus{}SPECS}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Selected electrodes}
         \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
             \PY{n}{samples\PYZus{}cheby}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{CHEBY\PYZus{}SPECS}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_18_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}filter\PYZus{}cheby}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n}{n} \PY{o}{=} \PY{l+m+mi}{200}
             \PY{n}{m} \PY{o}{=} \PY{l+m+mi}{150}
             \PY{n}{zeros} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{n}\PY{p}{)}
             \PY{n}{ones} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{m}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test single signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{times} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}
             \PY{n}{result}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{filter\PYZus{}cheby}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test multiple electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{n\PYZus{}electrodes} \PY{o}{=} \PY{l+m+mi}{3}
             \PY{n}{test\PYZus{}samples\PYZus{}1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{test\PYZus{}samples\PYZus{}2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{zeros}\PY{p}{)}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{test\PYZus{}samples\PYZus{}3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{zeros}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(}\PY{p}{[}\PY{n}{test\PYZus{}samples\PYZus{}1}\PY{p}{,} \PY{n}{test\PYZus{}samples\PYZus{}2}\PY{p}{,} \PY{n}{test\PYZus{}samples\PYZus{}3}\PY{p}{]}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
             \PY{n}{times} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{result}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{filter\PYZus{}cheby}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{result}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
         \PY{n}{test\PYZus{}filter\PYZus{}cheby}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test single signal

Test multiple electrodes
(3, 550)

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_19_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{filter-fir}{%
\subsection{Filter FIR}\label{filter-fir}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{k}{def} \PY{n+nf}{filter\PYZus{}firwin}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{order}\PY{o}{=}\PY{n}{FIR\PYZus{}ORDER}\PY{p}{,} \PY{n}{lowcut}\PY{o}{=}\PY{n}{FIR\PYZus{}LOWCUT}\PY{p}{,} \PY{n}{highcut}\PY{o}{=}\PY{n}{FIR\PYZus{}HIGHCUT}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{    Second filter applied by Eric, in matlab code from Archive.zip.}
         \PY{l+s+sd}{    Low order Hann Filter.}
         \PY{l+s+sd}{    }
         \PY{l+s+sd}{    Rmk: Length of the filter = number of coefficients, i.e. the filter order + 1.}
         \PY{l+s+sd}{    Note: A bandpass filter again.}
         \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{n}{length} \PY{o}{=} \PY{n}{order} \PY{o}{+} \PY{l+m+mi}{1} 
             \PY{n}{cutoff\PYZus{}frequencies} \PY{o}{=} \PY{p}{[}\PY{n}{lowcut}\PY{p}{,} \PY{n}{highcut}\PY{p}{]}
             
             \PY{n}{b1} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{firwin}\PY{p}{(}
                 \PY{n}{numtaps}\PY{o}{=}\PY{n}{length}\PY{p}{,}
                 \PY{n}{cutoff}\PY{o}{=}\PY{n}{cutoff\PYZus{}frequencies}\PY{p}{,} 
                 \PY{n}{pass\PYZus{}zero}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Otherwise is bandstop by default!}
                 \PY{n}{window}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{hann}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{beq} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{convolve}\PY{p}{(}\PY{n}{b1}\PY{p}{,} \PY{n}{b1}\PY{p}{)} \PY{c+c1}{\PYZsh{} 2 stage filter}
             
             \PY{c+c1}{\PYZsh{} Applying filters, with 0 phase lag}
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{filtfilt}\PY{p}{(}\PY{n}{beq}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{return} \PY{n}{filtered\PYZus{}samples}\PY{p}{,} \PY{n}{beq}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{beq} \PY{o}{=} \PY{n}{filter\PYZus{}firwin}\PY{p}{(}\PY{n}{samples\PYZus{}cheby}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}138}]:} \PY{n}{plot\PYZus{}frequency\PYZus{}response\PYZus{}digital}\PY{p}{(}\PY{n}{beq}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} All electrodes}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Selected electrodes}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_23_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{overview-of-the-2-successives-filters}{%
\subsection{Overview of the 2 successives
filters}\label{overview-of-the-2-successives-filters}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}141}]:} \PY{c+c1}{\PYZsh{} Consecutive filters on same graph \PYZhy{} Note: not same units on amplitudes!}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples\PYZus{}cheby}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{CHEBY\PYZus{}SPECS}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Consecutive filters on same graph \PYZhy{} Note: not same units on amplitudes!}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples\PYZus{}cheby}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{CHEBY\PYZus{}SPECS}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_25_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}filter\PYZus{}firwin}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n}{n} \PY{o}{=} \PY{l+m+mi}{200}
             \PY{n}{m} \PY{o}{=} \PY{l+m+mi}{150}
             \PY{n}{zeros} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{n}\PY{p}{)}
             \PY{n}{ones} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{m}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test single signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{times} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}
             \PY{n}{result}\PY{p}{,} \PY{n}{\PYZus{}}\PY{o}{=} \PY{n}{filter\PYZus{}firwin}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test multiple electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{n\PYZus{}electrodes} \PY{o}{=} \PY{l+m+mi}{3}
             \PY{n}{test\PYZus{}samples\PYZus{}1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{test\PYZus{}samples\PYZus{}2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{zeros}\PY{p}{)}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{zeros}\PY{p}{]}\PY{p}{)}
             \PY{n}{test\PYZus{}samples\PYZus{}3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{zeros}\PY{p}{,} \PY{n}{ones}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{zeros}\PY{p}{)}\PY{p}{]}\PY{p}{)}
             
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(}\PY{p}{[}\PY{n}{test\PYZus{}samples\PYZus{}1}\PY{p}{,} \PY{n}{test\PYZus{}samples\PYZus{}2}\PY{p}{,} \PY{n}{test\PYZus{}samples\PYZus{}3}\PY{p}{]}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
             \PY{n}{times} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n}{result}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{filter\PYZus{}firwin}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{times}\PY{p}{,} \PY{n}{result}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
         \PY{n}{test\PYZus{}filter\PYZus{}firwin}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test single signal

Test multiple electrodes
(3, 550)

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_26_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_26_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{preprocessing-remove-extreme-amplitudes-and-flat-regions}{%
\section{Preprocessing: Remove Extreme Amplitudes and Flat
Regions}\label{preprocessing-remove-extreme-amplitudes-and-flat-regions}}

\begin{itemize}
\tightlist
\item
  Extreme amplitude: mouse bumping against a wall
\item
  Flat regions: saturation of the device
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{k}{def} \PY{n+nf}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{coef}\PY{o}{=}\PY{n}{EXTREME\PYZus{}AMPLITUDE\PYZus{}COEF}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{    From Eric\PYZsq{}s code in Archive.}
         \PY{l+s+sd}{    Removing the data above 90\PYZpc{} of the extremum values.}
         \PY{l+s+sd}{    }
         \PY{l+s+sd}{    Note: dtype must be float to have NaNs. Int will fill with an arbitrarily large number.}
         \PY{l+s+sd}{    \PYZhy{} axis=None: compute min and max amplitudes accross all electrodes.}
         \PY{l+s+sd}{    \PYZhy{} axis=0: compute min and max per electrode.}
         \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{c+c1}{\PYZsh{} TODO(nina): Memory optimization: consider in place version of this function.}
             \PY{c+c1}{\PYZsh{} TODO(nina): Speed\PYZhy{}up: vectorize code wrt electrodes.}
             \PY{c+c1}{\PYZsh{} QUESTION: Compute min and max per electrode or across all electrodes?}
             \PY{c+c1}{\PYZsh{} QUESTION/VERIFICATION: Extreme amplitudes, after the filters, correspond to previous mice\PYZsq{}s bumps?}
             \PY{n}{samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
             \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
            
             \PY{n}{min\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmin}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{n}{axis}\PY{p}{)}
             \PY{n}{max\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmax}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{n}{axis}\PY{p}{)}
             
             \PY{k}{if} \PY{n}{axis}\PY{o}{==}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
                 \PY{n}{min\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{min\PYZus{}amplitude}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{max\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{max\PYZus{}amplitude}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{interval} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{min\PYZus{}amplitude}\PY{p}{,} \PY{n}{max\PYZus{}amplitude}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             
             \PY{k}{elif} \PY{n}{axis}\PY{o}{==}\PY{k+kc}{None}\PY{p}{:}
                 \PY{n}{min\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{min\PYZus{}amplitude}\PY{p}{)}
                 \PY{n}{max\PYZus{}amplitude} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{max\PYZus{}amplitude}\PY{p}{)}
                 \PY{n}{interval} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{min\PYZus{}amplitude}\PY{p}{,} \PY{n}{max\PYZus{}amplitude}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{interval} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{interval}\PY{p}{]} \PY{o}{*} \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{k}{else}\PY{p}{:}
                 \PY{k}{raise} \PY{n+ne}{ValueError}\PY{p}{(}\PY{p}{)}
         
             \PY{n}{valid\PYZus{}interval} \PY{o}{=} \PY{n}{interval} \PY{o}{*} \PY{n}{coef}
             
             \PY{n}{low\PYZus{}bool} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
             \PY{n}{high\PYZus{}bool} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros\PYZus{}like}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{low\PYZus{}bool}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{samples}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{valid\PYZus{}interval}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}
                 \PY{n}{high\PYZus{}bool}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{samples}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{valid\PYZus{}interval}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}
                
             \PY{n}{bad\PYZus{}amplitudes\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{logical\PYZus{}or}\PY{p}{(}\PY{n}{low\PYZus{}bool}\PY{p}{,} \PY{n}{high\PYZus{}bool}\PY{p}{)}
             \PY{n}{n\PYZus{}bad\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{bad\PYZus{}amplitudes\PYZus{}mask}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Electrode: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{. Found }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ points with extreme amplitude. }\PY{l+s+s1}{\PYZsq{}}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fill with NaN.}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{n\PYZus{}bad\PYZus{}samples}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{n\PYZus{}samples}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
             \PY{n}{filtered\PYZus{}samples}\PY{p}{[}\PY{n}{bad\PYZus{}amplitudes\PYZus{}mask}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
             \PY{k}{return} \PY{n}{filtered\PYZus{}samples}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{n}{samples\PYZus{}no\PYZus{}extreme} \PY{o}{=} \PY{n}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{samples\PYZus{}firwin}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Electrode: 1. Found 7/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 2. Found 7/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 3. Found 8/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 4. Found 6/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 5. Found 6/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 6. Found 8/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 7. Found 8/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 8. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 9. Found 7/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 10. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 11. Found 4/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 12. Found 9/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 13. Found 6/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 14. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 15. Found 6/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 16. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 17. Found 3/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 18. Found 7/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 19. Found 4/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 20. Found 4/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 21. Found 4/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 22. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 23. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 24. Found 6/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 25. Found 5/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 26. Found 8/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 27. Found 20/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 28. Found 8/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 29. Found 11/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 30. Found 11/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 31. Found 4/26041856 points with extreme amplitude. Fill with NaN.
Electrode: 32. Found 4/26041856 points with extreme amplitude. Fill with NaN.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}144}]:} \PY{c+c1}{\PYZsh{} Plot over the full time window here}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}\PY{n}{samples\PYZus{}firwin}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{FIR\PYZus{}SPECS}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}\PY{n}{samples\PYZus{}no\PYZus{}extreme}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{After Removing Extreme Amplitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_30_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_30_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n}{n\PYZus{}electrodes} \PY{o}{=} \PY{l+m+mi}{3}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with one electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{l+m+mf}{0.1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} expected = np.array([\PYZhy{}0.1, 0.1, \PYZhy{}0.2, np.nan, np.nan, 0.2])}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with one electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} expected = np.array([\PYZhy{}0.1, np.nan, \PYZhy{}0.2, np.nan, np.nan, 0.2])}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
         
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ electrode \PYZhy{} axis=None}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{n\PYZus{}electrodes}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1000}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{]}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} expected = np.array([\PYZhy{}0.1, np.nan, \PYZhy{}0.2, np.nan, np.nan, 0.2])}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
                 
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ electrode \PYZhy{} axis=\PYZhy{}1}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{n\PYZus{}electrodes}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1000}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mf}{0.2}\PY{p}{]}\PY{p}{]}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} expected = np.array([\PYZhy{}0.1, np.nan, \PYZhy{}0.2, np.nan, np.nan, 0.2])}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
         \PY{n}{test\PYZus{}remove\PYZus{}extreme\PYZus{}amplitudes}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test with one electrode
Electrode: 1. Found 2/6 points with extreme amplitude. Fill with NaN.
[ -0.1   0.1  -0.2  10.  -10.    0.2]
[[-0.1  0.1 -0.2  nan  nan  0.2]]

Test with one electrode
Electrode: 1. Found 2/6 points with extreme amplitude. Fill with NaN.
[ -0.1   nan  -0.2  10.  -10.    0.2]
[[-0.1  nan -0.2  nan  nan  0.2]]

Test with 3 electrode - axis=None
Electrode: 1. Found 0/6 points with extreme amplitude. Fill with NaN.
Electrode: 2. Found 1/6 points with extreme amplitude. Fill with NaN.
Electrode: 3. Found 1/6 points with extreme amplitude. Fill with NaN.
[[-1.e-01     nan -2.e-01  1.e+01 -1.e+01  2.e-01]
 [-1.e+00     nan -2.e+00  1.e+02 -1.e+02  3.e+00]
 [-1.e-01 -1.e+03 -2.e-01  1.e+01 -1.e+01  2.e-01]]
[[  -0.1    nan   -0.2   10.   -10.     0.2]
 [  -1.     nan   -2.     nan -100.     3. ]
 [  -0.1    nan   -0.2   10.   -10.     0.2]]

Test with 3 electrode - axis=-1
Electrode: 1. Found 2/6 points with extreme amplitude. Fill with NaN.
Electrode: 2. Found 2/6 points with extreme amplitude. Fill with NaN.
Electrode: 3. Found 2/6 points with extreme amplitude. Fill with NaN.
[[-1.e-01     nan -2.e-01  1.e+01 -1.e+01  2.e-01]
 [-1.e+00     nan -2.e+00  1.e+02 -1.e+02  3.e+00]
 [-1.e-01 -1.e+03 -2.e-01  1.e+01 -1.e+01  2.e-01]]
[[ -0.1   nan  -0.2   nan   nan   0.2]
 [ -1.    nan  -2.    nan   nan   3. ]
 [ -0.1   nan  -0.2   nan -10.    0.2]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{k}{def} \PY{n+nf}{contiguous\PYZus{}regions}\PY{p}{(}\PY{n}{condition}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{    Finds contiguous True regions of the boolean array \PYZdq{}condition\PYZdq{}. }
         \PY{l+s+sd}{    }
         \PY{l+s+sd}{    Returns a 2D array where:}
         \PY{l+s+sd}{    \PYZhy{} the first column is the start index of the region,}
         \PY{l+s+sd}{    \PYZhy{} the second column is the end index.}
         \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{c+c1}{\PYZsh{} TODO(nina): Speed\PYZhy{}up: vectorization code wrt electrodes.}
             \PY{n}{condition} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{condition}\PY{p}{)}
             \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{condition}\PY{o}{.}\PY{n}{shape}
             \PY{c+c1}{\PYZsh{} Changes in \PYZdq{}condition\PYZdq{}}
             \PY{n}{d} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{condition}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             
             \PY{n}{indices} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{idx}\PY{p}{,} \PY{o}{=} \PY{n}{d}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{nonzero}\PY{p}{(}\PY{p}{)} 
                 \PY{n}{condition\PYZus{}i} \PY{o}{=} \PY{n}{condition}\PY{p}{[}\PY{n}{i}\PY{p}{]}
         
                 \PY{c+c1}{\PYZsh{} We need to start things after the change in \PYZdq{}condition\PYZdq{}. Therefore, }
                 \PY{c+c1}{\PYZsh{} we\PYZsq{}ll shift the index by 1 to the right.}
                 \PY{n}{idx} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
         
                 \PY{k}{if} \PY{n}{condition\PYZus{}i}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}
                     \PY{c+c1}{\PYZsh{} If the start of condition is True prepend a 0}
                     \PY{n}{idx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{r\PYZus{}}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{idx}\PY{p}{]}
         
                 \PY{k}{if} \PY{n}{condition\PYZus{}i}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{:}
                     \PY{c+c1}{\PYZsh{} If the end of condition is True, append the length of the array}
                     \PY{n}{idx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{r\PYZus{}}\PY{p}{[}\PY{n}{idx}\PY{p}{,} \PY{n}{condition\PYZus{}i}\PY{o}{.}\PY{n}{size}\PY{p}{]} \PY{c+c1}{\PYZsh{} Edit}
         
                 \PY{c+c1}{\PYZsh{} Reshape the result into two columns}
                 \PY{n}{idx}\PY{o}{.}\PY{n}{shape} \PY{o}{=} \PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
                 \PY{n}{indices}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{idx}
             
             \PY{k}{return} \PY{n}{indices}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{k}{def} \PY{n+nf}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{raw\PYZus{}samples}\PY{p}{,} \PY{n}{samples}\PY{p}{,} \PY{n}{min\PYZus{}flat}\PY{o}{=}\PY{n}{MIN\PYZus{}FLAT}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{n}{PAD\PYZus{}FLAT}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{    Remove data in samples around flat regions of the **raw** samples.}
         \PY{l+s+sd}{    Minimum of min\PYZus{}flat consecutives 0 slopes.}
         \PY{l+s+sd}{    Pad with pad\PYZus{}flat before and after the consecutives 0 slopes.}
         \PY{l+s+sd}{    }
         \PY{l+s+sd}{    Note: dtype must be float to have NaNs. Int will fill with an arbitrarily large number.}
         \PY{l+s+sd}{    }
         \PY{l+s+sd}{    Then rescale around 0 mean.}
         \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{c+c1}{\PYZsh{} TODO(nina): Is this information in ValidSample field?}
             \PY{c+c1}{\PYZsh{} TODO(nina): Memory optimization: consider doing this function in place.}
             \PY{c+c1}{\PYZsh{} TODO(nina): Speed\PYZhy{}up: vectorization code wrt electrodes.}
             \PY{n}{samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
             \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{n}{samples}\PY{p}{)}  
             
             \PY{n}{slopes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{raw\PYZus{}samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{slope0\PYZus{}mask} \PY{o}{=} \PY{n}{slopes} \PY{o}{==} \PY{l+m+mi}{0}
             
             \PY{n}{contiguous\PYZus{}indices} \PY{o}{=} \PY{n}{contiguous\PYZus{}regions}\PY{p}{(}\PY{n}{slope0\PYZus{}mask}\PY{p}{)}
             
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                 \PY{n}{contiguous\PYZus{}ids} \PY{o}{=} \PY{n}{contiguous\PYZus{}indices}\PY{p}{[}\PY{n}{i}\PY{p}{]}
                 \PY{n}{lengths} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{end} \PY{o}{\PYZhy{}} \PY{n}{start} \PY{o}{+} \PY{l+m+mi}{1} \PY{k}{for} \PY{n}{start}\PY{p}{,} \PY{n}{end} \PY{o+ow}{in} \PY{n}{contiguous\PYZus{}ids}\PY{p}{]}\PY{p}{)}
                 
                 \PY{k}{for} \PY{n}{length}\PY{p}{,} \PY{n}{ids} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{lengths}\PY{p}{,} \PY{n}{contiguous\PYZus{}ids}\PY{p}{)}\PY{p}{:}
                     \PY{k}{if} \PY{n}{length} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{min\PYZus{}flat}\PY{p}{:}
                         \PY{n}{start\PYZus{}remove} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{ids}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{pad\PYZus{}flat}\PY{p}{]}\PY{p}{)}
                         \PY{n}{end\PYZus{}remove} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{[}\PY{n}{n\PYZus{}samples}\PY{p}{,} \PY{n}{ids}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{pad\PYZus{}flat} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
                         \PY{n}{filtered\PYZus{}samples}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{start\PYZus{}remove}\PY{p}{:}\PY{n}{end\PYZus{}remove}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
         
             \PY{k}{return} \PY{n}{filtered\PYZus{}samples}
         
         \PY{k}{def} \PY{n+nf}{remove\PYZus{}flat\PYZus{}and\PYZus{}normalize}\PY{p}{(}\PY{n}{raw\PYZus{}samples}\PY{p}{,} \PY{n}{samples}\PY{p}{,} \PY{n}{min\PYZus{}flat}\PY{o}{=}\PY{n}{MIN\PYZus{}FLAT}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{n}{PAD\PYZus{}FLAT}\PY{p}{)}\PY{p}{:}
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{raw\PYZus{}samples}\PY{p}{,} \PY{n}{samples}\PY{p}{,} \PY{n}{min\PYZus{}flat}\PY{o}{=}\PY{n}{min\PYZus{}flat}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{n}{pad\PYZus{}flat}\PY{p}{)}
             \PY{n}{filtered\PYZus{}samples} \PY{o}{=} \PY{n}{normalize}\PY{p}{(}\PY{n}{filtered\PYZus{}samples}\PY{p}{)}
             \PY{k}{return} \PY{n}{filtered\PYZus{}samples}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{n}{samples\PYZus{}no\PYZus{}flat} \PY{o}{=} \PY{n}{remove\PYZus{}flat\PYZus{}and\PYZus{}normalize}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{samples\PYZus{}no\PYZus{}extreme}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}149}]:} \PY{c+c1}{\PYZsh{} QUESTION: Why removing flat elements here, using the original samples? Why not removing them directly?}
          
          \PY{c+c1}{\PYZsh{} Plot over the full time window here}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}no\PYZus{}extreme}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{After Removing Extreme Amplitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}no\PYZus{}flat}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{After Removing Flatnesses}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_35_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_35_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}46}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}remove\PYZus{}flat}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{test with not enough consecutives flatness \PYZhy{}  no pad}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{min\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{9}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{test with enough consecutives flatness \PYZhy{} no pad}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{test with enough consecutives flatness \PYZhy{} pad 1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{test with enough consecutives flatness \PYZhy{} pad 3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{test with enough consecutives flatness \PYZhy{} pad 100}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{]}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
             \PY{n}{result} \PY{o}{=} \PY{n}{remove\PYZus{}flat}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{pad\PYZus{}flat}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
         \PY{n}{test\PYZus{}remove\PYZus{}flat}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

test with not enough consecutives flatness -  no pad
[[1. 2. 2. 2. 2. 2. 2. 2. 5. 6. 7. 7. 7. 8. 8. 9.]]

test with enough consecutives flatness - no pad
[[ 1. nan nan nan nan nan nan nan nan nan  5.  6.  7.  7.  7.  8.  8.  9.]]

test with enough consecutives flatness - pad 1
[[nan nan nan nan nan nan nan nan nan nan nan  6.  7.  7.  7.  8.  8.  9.]]

test with enough consecutives flatness - pad 3
[[nan nan nan nan nan nan nan nan nan nan nan nan nan  7.  7.  8.  8.  9.]]

test with enough consecutives flatness - pad 100
[[nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan nan]]

    \end{Verbatim}

    \hypertarget{inspection-of-signals-obtained-after-preprocessing}{%
\section{Inspection of Signals Obtained After
Preprocessing}\label{inspection-of-signals-obtained-after-preprocessing}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}155}]:} \PY{n}{title\PYZus{}preproc} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples After Preprocessing \PYZhy{} Sampling Frequency = }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{Hz}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{SF}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} All electrodes}
          \PY{c+c1}{\PYZsh{} QUESTION: Why these random vertical translations of the signals?}
          \PY{c+c1}{\PYZsh{} QUESTION: Should we renormalized here already?}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}no\PYZus{}flat}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title\PYZus{}preproc}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Selected electrodes}
          \PY{c+c1}{\PYZsh{} QUESTION: Why do electrodes 1 and 2 seem to be inversed from one another?}
          \PY{n}{plot\PYZus{}samples\PYZus{}several\PYZus{}windows}\PY{p}{(}
              \PY{n}{samples\PYZus{}no\PYZus{}flat}\PY{p}{,} \PY{n}{list\PYZus{}n\PYZus{}msecs}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{n}{title\PYZus{}preproc}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{SELECTED\PYZus{}ELECTRODES}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} One plot per electrode \PYZhy{} 10ms time window}
          \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N\PYZus{}ELECTRODES}\PY{p}{)}\PY{p}{:}
              \PY{n}{plot\PYZus{}samples}\PY{p}{(}\PY{n}{samples\PYZus{}no\PYZus{}flat}\PY{p}{,} \PY{n}{n\PYZus{}msecs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{electrodes\PYZus{}nums}\PY{o}{=}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_5.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_6.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_8.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_9.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_10.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_11.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_12.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_13.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_14.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_15.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_16.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_17.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_18.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_19.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_20.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_21.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_22.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_23.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_24.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_25.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_26.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_27.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_28.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_29.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_30.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_31.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_32.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_33.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_34.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_35.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}41}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}correlation}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} TODO(nina): Why 7 correlation values? Why does one nan impact 4 values?}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test without Nans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                 \PY{p}{[}\PY{l+m+mf}{1.}\PY{p}{,} \PY{l+m+mf}{2.}\PY{p}{,} \PY{l+m+mf}{3.}\PY{p}{,} \PY{l+m+mf}{4.}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{l+m+mf}{2.}\PY{p}{,} \PY{l+m+mf}{3.}\PY{p}{,} \PY{l+m+mf}{4.}\PY{p}{,} \PY{l+m+mf}{5.}\PY{p}{]}\PY{p}{]}\PY{p}{)}
             \PY{n}{corr} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{correlate}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with Nans}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                 \PY{p}{[}\PY{l+m+mf}{1.}\PY{p}{,} \PY{l+m+mf}{2.}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{,} \PY{l+m+mf}{4.}\PY{p}{]}\PY{p}{,}
                 \PY{p}{[}\PY{l+m+mf}{2.}\PY{p}{,} \PY{l+m+mf}{3.}\PY{p}{,} \PY{l+m+mf}{4.}\PY{p}{,} \PY{l+m+mf}{5.}\PY{p}{]}\PY{p}{]}\PY{p}{)}
             \PY{n}{corr} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{correlate}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
             \PY{n}{corr\PYZus{}nanmean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmean}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{corr\PYZus{}nanmean}\PY{p}{)}
             
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test with Nans using masked arrays}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{x} \PY{o}{=} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{y} \PY{o}{=} \PY{n}{test\PYZus{}samples}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{nan\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{x}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{nan\PYZus{}x}\PY{p}{)}
             \PY{n}{nan\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{y}\PY{p}{)}
             \PY{n}{mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{logical\PYZus{}or}\PY{p}{(}\PY{n}{nan\PYZus{}x}\PY{p}{,} \PY{n}{nan\PYZus{}y}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{mask}\PY{p}{)}
             \PY{n}{normx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{norm}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{o}{\PYZti{}}\PY{n}{nan\PYZus{}x}\PY{p}{]}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{normx}\PY{p}{)}
             \PY{n}{normy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{norm}\PY{p}{(}\PY{n}{y}\PY{p}{[}\PY{o}{\PYZti{}}\PY{n}{nan\PYZus{}y}\PY{p}{]}\PY{p}{)}
             \PY{n}{ma\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ma}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{mask}\PY{o}{=}\PY{n}{nan\PYZus{}x}\PY{p}{)}
             \PY{n}{ma\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ma}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{mask}\PY{o}{=}\PY{n}{nan\PYZus{}y}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{ma\PYZus{}x}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{ma\PYZus{}y}\PY{p}{)}
             
             \PY{n}{corr} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{correlate}\PY{p}{(}\PY{n}{ma\PYZus{}x}\PY{p}{,} \PY{n}{ma\PYZus{}y}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} corr = corr / (normx * normy) }
             \PY{n+nb}{print}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
         
         \PY{n}{test\PYZus{}correlation}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test without Nans
[ 5. 14. 26. 40. 29. 18.  8.]

Test with Nans
[ 5. 14. nan nan nan nan  8.]
9.0

Test with Nans using masked arrays
[False False  True False]
[False False  True False]
4.58257569495584
[1.0 2.0 -- 4.0]
[2.0 3.0 4.0 5.0]
[nan]

    \end{Verbatim}

    \hypertarget{correlations-of-electrodes}{%
\section{Correlations of electrodes}\label{correlations-of-electrodes}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}88}]:} \PY{c+c1}{\PYZsh{} First try with cross\PYZhy{}correlation (specific for signals)}
         \PY{c+c1}{\PYZsh{} TODO(nina): Deal with the Nans}
         
         \PY{n}{preprocessed\PYZus{}samples} \PY{o}{=} \PY{n}{samples\PYZus{}no\PYZus{}flat}
         
         \PY{n}{correlation\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{N\PYZus{}ELECTRODES}\PY{p}{,}\PY{p}{)} \PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N\PYZus{}ELECTRODES}\PY{p}{)}\PY{p}{:}
             \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{N\PYZus{}ELECTRODES}\PY{p}{)}\PY{p}{:}
                 \PY{n}{corr} \PY{o}{=} \PY{n}{signal}\PY{o}{.}\PY{n}{correlate}\PY{p}{(}\PY{n}{preprocessed\PYZus{}samples}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{100}\PY{p}{]}\PY{p}{,} \PY{n}{preprocessed\PYZus{}samples}\PY{p}{[}\PY{n}{j}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{100}\PY{p}{]}\PY{p}{)}
                 \PY{n}{corr\PYZus{}nanmean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmean}\PY{p}{(}\PY{n}{corr}\PY{p}{)}
                 \PY{n}{correlation\PYZus{}matrix}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{corr\PYZus{}nanmean}
                 \PY{n}{correlation\PYZus{}matrix}\PY{p}{[}\PY{n}{j}\PY{p}{,} \PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{corr\PYZus{}nanmean}
         
         \PY{n}{ma\PYZus{}correlation\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ma}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{correlation\PYZus{}matrix}\PY{p}{,} \PY{n}{mask}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{correlation\PYZus{}matrix}\PY{p}{)}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Number of non\PYZhy{}nan entries in correlation matrix: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/1024}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{np}\PY{o}{.}\PY{n}{count\PYZus{}nonzero}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{correlation\PYZus{}matrix}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Number of non-nan entries in correlation matrix: 960

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}97}]:} \PY{c+c1}{\PYZsh{} Second try with usual Pearson (?) correlation (may not be suited for signals)}
         \PY{c+c1}{\PYZsh{} TODO(nina): Compare with matrix of distances between electrodes?}
         \PY{c+c1}{\PYZsh{} TODO(nina): Investigate our to compute the correlation suited for signals}
         
         \PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}
             \PY{n}{data}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{transpose}\PY{p}{(}\PY{n}{samples\PYZus{}no\PYZus{}flat}\PY{p}{)}\PY{p}{,} 
             \PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{N\PYZus{}ELECTRODES}\PY{p}{)}\PY{p}{]}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} df}
         \PY{c+c1}{\PYZsh{} print(df.columns)}
         
         \PY{n}{corr\PYZus{}matrix} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Number of non\PYZhy{}nan entries in correlation matrix: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/1024}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{np}\PY{o}{.}\PY{n}{count\PYZus{}nonzero}\PY{p}{(}\PY{o}{\PYZti{}}\PY{n}{np}\PY{o}{.}\PY{n}{isnan}\PY{p}{(}\PY{n}{corr\PYZus{}matrix}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{corr\PYZus{}matrix}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         
         \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
         \PY{n}{ax1} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
         
         \PY{n}{cax} \PY{o}{=} \PY{n}{ax1}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{corr\PYZus{}matrix}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{nearest}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{viridis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax1}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{k+kc}{True}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlation Matrix of Electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
         \PY{n}{labels} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{columns}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{df}\PY{o}{.}\PY{n}{columns}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{yticks}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{columns}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{df}\PY{o}{.}\PY{n}{columns}\PY{p}{)}
         
         \PY{n}{cbar} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{colorbar}\PY{p}{(}\PY{n}{cax}\PY{p}{,} \PY{n}{ticks}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{1.}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{num}\PY{o}{=}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
         \PY{n}{cbar}\PY{o}{.}\PY{n}{set\PYZus{}label}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlations}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{270}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Number of non-nan entries in correlation matrix: 1024/1024
(32, 32)

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_42_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{spike-sorting-get-peaks-by-thresholding-minima-in-amplitude}{%
\section{Spike Sorting: Get Peaks by Thresholding Minima in
Amplitude}\label{spike-sorting-get-peaks-by-thresholding-minima-in-amplitude}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}156}]:} \PY{k}{def} \PY{n+nf}{mad}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}Mean Absolute Deviation.\PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{n}{nanmean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmean}\PY{p}{(}\PY{n}{data}\PY{p}{,} \PY{n}{axis}\PY{p}{)}
              \PY{n}{deviations} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{data} \PY{o}{\PYZhy{}} \PY{n}{nanmean}\PY{p}{)}
              \PY{n}{mad} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nanmean}\PY{p}{(}\PY{n}{deviations}\PY{p}{,} \PY{n}{axis}\PY{p}{)}
              \PY{k}{return} \PY{n}{mad}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}157}]:} \PY{c+c1}{\PYZsh{} QUESTION/VERIFICATION: This part should be replaced by a fancier spike sorting algorithm?}
          \PY{k}{def} \PY{n+nf}{get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{n}{samples}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
          \PY{l+s+sd}{    Find minima in the samples: True if there is a minimum, False if not.}
          \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{n}{samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
              \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
              
              \PY{n}{slopes} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
              
              \PY{n}{neg\PYZus{}slope\PYZus{}mask} \PY{o}{=} \PY{n}{slopes}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0}
              \PY{n}{pos\PYZus{}slope\PYZus{}mask} \PY{o}{=} \PY{n}{slopes}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}
              \PY{n}{minima\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{logical\PYZus{}and}\PY{p}{(}\PY{n}{neg\PYZus{}slope\PYZus{}mask}\PY{p}{,} \PY{n}{pos\PYZus{}slope\PYZus{}mask}\PY{p}{)}
              
              \PY{c+c1}{\PYZsh{} First and last element cannot be minima}
              \PY{n}{false} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{k+kc}{False}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
              \PY{n}{false} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{false}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n}{minima\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{false}\PY{p}{,} \PY{n}{minima\PYZus{}mask}\PY{p}{,} \PY{n}{false}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              
              \PY{k}{return} \PY{n}{minima\PYZus{}mask}
          
          
          \PY{k}{def} \PY{n+nf}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
          \PY{l+s+sd}{    Find peaks in the samples: True if there is a peak, False if not.}
          \PY{l+s+sd}{    Note: the std of the data is estimated through the MAD, more robust to noise.}
          \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{n}{samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
              \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
              
              \PY{n}{minima\PYZus{}mask} \PY{o}{=} \PY{n}{get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
              
              \PY{n}{std} \PY{o}{=} \PY{l+m+mf}{1.4826} \PY{o}{*} \PY{n}{mad}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
              
              \PY{n}{threshold} \PY{o}{=} \PY{o}{\PYZhy{}} \PY{n}{threshold\PYZus{}std} \PY{o}{*} \PY{n}{std}
              \PY{n}{threshold\PYZus{}mask} \PY{o}{=} \PY{n}{samples}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{threshold}
              
              \PY{c+c1}{\PYZsh{} First and last element cannot be peaks}
              \PY{n}{false} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{k+kc}{False}\PY{p}{]}\PY{p}{]} \PY{o}{*} \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
              \PY{n}{false} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{false}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n}{threshold\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{concatenate}\PY{p}{(}\PY{p}{[}\PY{n}{false}\PY{p}{,} \PY{n}{threshold\PYZus{}mask}\PY{p}{,} \PY{n}{false}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              
              \PY{n}{peaks\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{logical\PYZus{}and}\PY{p}{(}\PY{n}{minima\PYZus{}mask}\PY{p}{,} \PY{n}{threshold\PYZus{}mask}\PY{p}{)}
              \PY{k}{return} \PY{n}{peaks\PYZus{}mask}
              
          
          \PY{k}{def} \PY{n+nf}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{p}{,} \PY{n}{channel\PYZus{}id}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} }
          \PY{l+s+sd}{    Finds peaks in our data}
          \PY{l+s+sd}{    Code based from Abdul\PYZsq{}s code \PYZam{}}
          \PY{l+s+sd}{    https://www.frontiersin.org/articles/10.3389/fnins.2016.00537/full}
          
          \PY{l+s+sd}{    Peaks are defined as minima that are threshold*std away from 0}
          \PY{l+s+sd}{    Returns: 1 if there is a peak, 0 if not}
          \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{n}{samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{atleast\PYZus{}2d}\PY{p}{(}\PY{n}{samples}\PY{p}{)}
              \PY{n}{n\PYZus{}electrodes}\PY{p}{,} \PY{n}{n\PYZus{}samples} \PY{o}{=} \PY{n}{samples}\PY{o}{.}\PY{n}{shape}
              
              \PY{n}{peaks\PYZus{}mask} \PY{o}{=} \PY{n}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{p}{)}
              
              \PY{n}{peaks} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
              \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n\PYZus{}electrodes}\PY{p}{)}\PY{p}{:}
                  \PY{n}{peaks\PYZus{}ids} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{peaks\PYZus{}mask}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                  \PY{n}{peaks\PYZus{}amplitudes} \PY{o}{=} \PY{n}{samples}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{peaks\PYZus{}ids}\PY{p}{]}
                  \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Electrode }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{. Found }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ peaks over }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ recorded data.}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                      \PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{peaks\PYZus{}ids}\PY{p}{)}\PY{p}{,} \PY{n}{n\PYZus{}samples}\PY{p}{)}\PY{p}{)}
                  
                  \PY{n}{peaks\PYZus{}i} \PY{o}{=} \PY{p}{\PYZob{}}
                      \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ids}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{peaks\PYZus{}ids}\PY{p}{,}
                      \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{amplitudes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{peaks\PYZus{}amplitudes}\PY{p}{\PYZcb{}}
                  \PY{n}{peaks}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{peaks\PYZus{}i}
                  
              \PY{k}{return} \PY{n}{peaks}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}100}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{p}{)}\PY{p}{:}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test \PYZhy{} a single electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test \PYZhy{} 3 electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                  \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
          \PY{n}{test\PYZus{}get\PYZus{}minima\PYZus{}mask}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test - a single electrode
[[False False False False  True False False  True False]]

Test - 3 electrodes
[[False False False False  True False False  True False]
 [False False False False  True False False  True False]
 [False False False False  True False False  True False]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}101}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{p}{)}\PY{p}{:}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 1 std away from 0, small minimum \PYZhy{} a single electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}   
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 1 std away from 0, large minimum \PYZhy{} a single electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}    
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 3 std away from 0, large minimum \PYZhy{} a single electrode}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 3 std away from 0, large minimum 3 electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                  \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{21}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{11}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{22}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{12}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
          \PY{n}{test\PYZus{}get\PYZus{}peaks\PYZus{}mask}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test: 1 std away from 0, small minimum - a single electrode
[ 1 -2  6  4  3  4  1 -1  1]
Std: 2.424
[[False False False False False False False False False]]

Test: 1 std away from 0, large minimum - a single electrode
[  1  -2   6   4   3   4   1 -10   1]
Std: 4.433
[[False False False False False False False  True False]]

Test: 3 std away from 0, large minimum - a single electrode
[  1 -20   6   4   3   4   1 -10   1]
Std: 7.95
[[False  True False False False False False  True False]]

Test: 3 std away from 0, large minimum 3 electrodes
[[  1 -20   6   4   3   4   1 -10   1]
 [  0 -21   5   3   2   3   0 -11   0]
 [ -1 -22   4   2   1   2  -1 -12  -1]]
[[False  True False False False False False  True False]
 [False  True False False False False False  True False]
 [False  True False False False False False  True False]]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}108}]:} \PY{k}{def} \PY{n+nf}{test\PYZus{}get\PYZus{}peaks}\PY{p}{(}\PY{p}{)}\PY{p}{:}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 1 std away from 0, small minimum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}   
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 1 std away from 0, large minimum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}    
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
              
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 3 std away from 0, large minimum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Std: }\PY{l+s+si}{\PYZob{}:.4\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{nanstd}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}\PY{p}{)}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Test: 3 std away from 0, large minimum 3 electrodes}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
              \PY{n}{test\PYZus{}samples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}
                  \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{21}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{11}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                  \PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{22}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{12}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{)}
              \PY{n}{result} \PY{o}{=} \PY{n}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{test\PYZus{}samples}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{n+nb}{print}\PY{p}{(}\PY{n}{result}\PY{p}{)}
          \PY{n}{test\PYZus{}get\PYZus{}peaks}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

Test: 1 std away from 0, small minimum
[ 1 -2  6  4  3  4  1 -1  1]
Std: 2.424
Electrode 1. Found 0 peaks over 9 recorded data.
\{0: \{'ids': array([], dtype=int64), 'amplitudes': array([], dtype=int64)\}\}

Test: 1 std away from 0, large minimum
[  1  -2   6   4   3   4   1 -10   1]
Std: 4.433
Electrode 1. Found 1 peaks over 9 recorded data.
\{0: \{'ids': array([7]), 'amplitudes': array([-10])\}\}

Test: 3 std away from 0, large minimum
[  1 -20   6   4   3   4   1 -10   1]
Std: 7.95
Electrode 1. Found 2 peaks over 9 recorded data.

Test: 3 std away from 0, large minimum 3 electrodes
[[  1 -20   6   4   3   4   1 -10   1]
 [  0 -21   5   3   2   3   0 -11   0]
 [ -1 -22   4   2   1   2  -1 -12  -1]]
Electrode 1. Found 2 peaks over 9 recorded data.
Electrode 2. Found 2 peaks over 9 recorded data.
Electrode 3. Found 2 peaks over 9 recorded data.
\{0: \{'ids': array([1, 7]), 'amplitudes': array([-20, -10])\}, 1: \{'ids': array([1, 7]), 'amplitudes': array([-21, -11])\}, 2: \{'ids': array([1, 7]), 'amplitudes': array([-22, -12])\}\}

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}158}]:} \PY{n}{peaks} \PY{o}{=} \PY{n}{get\PYZus{}peaks}\PY{p}{(}\PY{n}{samples\PYZus{}no\PYZus{}extreme}\PY{p}{,} \PY{n}{threshold\PYZus{}std}\PY{o}{=}\PY{n}{SPIKE\PYZus{}THRESHOLD\PYZus{}STD}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} print(peaks)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Electrode 1. Found 24816 peaks over 26041856 recorded data.
Electrode 2. Found 24729 peaks over 26041856 recorded data.
Electrode 3. Found 20983 peaks over 26041856 recorded data.
Electrode 4. Found 25668 peaks over 26041856 recorded data.
Electrode 5. Found 39447 peaks over 26041856 recorded data.
Electrode 6. Found 35930 peaks over 26041856 recorded data.
Electrode 7. Found 27910 peaks over 26041856 recorded data.
Electrode 8. Found 17969 peaks over 26041856 recorded data.
Electrode 9. Found 13782 peaks over 26041856 recorded data.
Electrode 10. Found 14259 peaks over 26041856 recorded data.
Electrode 11. Found 14418 peaks over 26041856 recorded data.
Electrode 12. Found 15538 peaks over 26041856 recorded data.
Electrode 13. Found 14957 peaks over 26041856 recorded data.
Electrode 14. Found 14996 peaks over 26041856 recorded data.
Electrode 15. Found 13318 peaks over 26041856 recorded data.
Electrode 16. Found 4277 peaks over 26041856 recorded data.
Electrode 17. Found 48801 peaks over 26041856 recorded data.
Electrode 18. Found 47735 peaks over 26041856 recorded data.
Electrode 19. Found 86797 peaks over 26041856 recorded data.
Electrode 20. Found 102498 peaks over 26041856 recorded data.
Electrode 21. Found 106419 peaks over 26041856 recorded data.
Electrode 22. Found 96298 peaks over 26041856 recorded data.
Electrode 23. Found 75902 peaks over 26041856 recorded data.
Electrode 24. Found 68429 peaks over 26041856 recorded data.
Electrode 25. Found 51382 peaks over 26041856 recorded data.
Electrode 26. Found 49969 peaks over 26041856 recorded data.
Electrode 27. Found 91035 peaks over 26041856 recorded data.
Electrode 28. Found 55466 peaks over 26041856 recorded data.
Electrode 29. Found 55303 peaks over 26041856 recorded data.
Electrode 30. Found 49411 peaks over 26041856 recorded data.
Electrode 31. Found 59093 peaks over 26041856 recorded data.
Electrode 32. Found 47723 peaks over 26041856 recorded data.

    \end{Verbatim}

    \hypertarget{load-and-plot-nvt-files-video-tracking}{%
\section{2. Load and Plot NVT files: Video
Tracking}\label{load-and-plot-nvt-files-video-tracking}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}104}]:} \PY{k}{def} \PY{n+nf}{load\PYZus{}nvt}\PY{p}{(}\PY{n}{data\PYZus{}file}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
          \PY{l+s+sd}{    Read Neuralynx NVT data.}
          \PY{l+s+sd}{    https://neuralynx.com/software/NeuralynxDataFileFormats.pdf}
          \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{data\PYZus{}file}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rb}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{fid}\PY{p}{:}
                  \PY{n}{fid}\PY{o}{.}\PY{n}{seek}\PY{p}{(}\PY{n}{HEADER\PYZus{}SIZE}\PY{p}{)}
                  
                  \PY{n}{data\PYZus{}format} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dtype}\PY{p}{(}\PY{p}{[}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stx}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint16}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint16}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data\PYZus{}size}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint16}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TimeStamp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint64}\PY{p}{)}\PY{p}{,} \PY{c+c1}{\PYZsh{} in um}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{uint32}\PY{p}{,} \PY{l+m+mi}{400}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nrc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int16}\PY{p}{)}\PY{p}{,}  \PY{c+c1}{\PYZsh{} Unused}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{extracted\PYZus{}x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{extracted\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{extracted\PYZus{}angle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{)}\PY{p}{,}
                      \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{targets}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{int32}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{)}\PY{p}{]}\PY{p}{)}
                  \PY{n}{raw} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{fromfile}\PY{p}{(}\PY{n}{fid}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{data\PYZus{}format}\PY{p}{)}
              
              \PY{k}{return} \PY{n}{raw}
          
          \PY{n}{nvt\PYZus{}file} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}05\PYZhy{}31\PYZus{}15\PYZhy{}43\PYZhy{}39/VT1.nvt}\PY{l+s+s1}{\PYZsq{}}
          \PY{n}{nvt\PYZus{}raw} \PY{o}{=} \PY{n}{load\PYZus{}nvt}\PY{p}{(}\PY{n}{nvt\PYZus{}file}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}105}]:} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nvt\PYZus{}raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TimeStamp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Less time steps than raw data?}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}105}]:} 48754
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n+nb}{len}\PY{p}{(}\PY{n}{nvt\PYZus{}raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{extracted\PYZus{}x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} 
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}9}]:} 48807
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{n}{nvt\PYZus{}raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{extracted\PYZus{}x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{10}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}10}]:} array([23724032,        0,        0,        0,        0,        0,
                       0,        0,        0,        0], dtype=int32)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}112}]:} \PY{c+c1}{\PYZsh{} Look at the Samples}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsh{} Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{)}  
          
          \PY{c+c1}{\PYZsh{} ?: shape is (50863, 512): what is 512?}
          \PY{c+c1}{\PYZsh{} if we ravel, then there is not enough timeStamps?}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}
          
          \PY{n}{samples\PYZus{}ravel} \PY{o}{=} \PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Samples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
          \PY{n}{samples\PYZus{}ravel\PYZus{}end} \PY{o}{=} \PY{n}{samples\PYZus{}ravel}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1000}\PY{p}{:}\PY{p}{]}
          
          \PY{c+c1}{\PYZsh{} why does it end by 32767??}
          \PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{samples\PYZus{}ravel\PYZus{}end}\PY{o}{==}\PY{l+m+mi}{32767}\PY{p}{)}\PY{o}{==}\PY{n+nb}{len}\PY{p}{(}\PY{n}{samples\PYZus{}ravel\PYZus{}end}\PY{p}{)}\PY{p}{)}
          
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsh{} NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+m+mi}{512}\PY{p}{)}
          \PY{n}{invalid\PYZus{}mask} \PY{o}{=} \PY{p}{(}\PY{n}{raw}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NumValidSamples}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{!=}\PY{l+m+mi}{512}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{invalid\PYZus{}mask}\PY{p}{)}\PY{p}{)}  \PY{c+c1}{\PYZsh{} But it\PYZsq{}s not the last ones necessarily}
          \PY{n+nb}{print}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{invalid\PYZus{}mask}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

\# Samples
[[  977  1192  1241 {\ldots}  1837  2042  2082]
 [ 1704  1230  1031 {\ldots}   102   189   610]
 [  498   309   418 {\ldots}  1041  1193  1127]
 {\ldots}
 [-2309 -2573 -2721 {\ldots} -2265 -2348 -2373]
 [-2466 -2587 -2486 {\ldots}  4063  4096  4069]
 [ 4258  4316  4192 {\ldots}  4063  4096  4069]]
(50863, 512)
[[-2466 -2587 -2486 {\ldots}  4063  4096  4069]
 [ 4258  4316  4192 {\ldots}  4063  4096  4069]]
False

\# NumValidSamples
(50863,)
[512 512 512 {\ldots} 512 512 373]
[ True  True  True {\ldots}  True  True False]
30
[38491 38492 38493 38494 38495 38496 38497 38498 38499 38500 38501 38502
 38503 47966 47967 47968 47969 47970 47971 47972 47973 47974 47975 47976
 47977 47978 47979 47980 47981 50862]

    \end{Verbatim}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
